<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>چرخش کره ماه و پس‌زمینه ستاره‌ها</title>
  <!-- کتابخانه سه‌جی‌اس (نسخه نسبتا جدید) -->
  <script src="https://cdn.jsdelivr.net/npm/three@0.151.3/build/three.min.js"></script>

  <style>
    body, html {
      margin: 0; 
      padding: 0;
      overflow: hidden; /* برای تمام‌صفحه بودن */
      background: black;
      height: 100%;
    }
    /* بوم ستاره ها (در پس‌زمینه) */
    #starsCanvas {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -2; /* عقب‌تر از همه باشد */
    }
    /* خروجی رندر سه‌جی‌اس (کره ماه) */
    #three-container {
      position: fixed;
      top: 0;
      left: 0;
      z-index: -1; /* بین بوم ستاره ها و سایر محتوا */
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>
  <!-- بوم ستاره‌ها -->
  <canvas id="starsCanvas"></canvas>

  <!-- محلی برای قراردادن رندر سه‌بعدی (کره ماه) -->
  <div id="three-container"></div>

  <script>
  /********************************************/
  /* ۱) کد ستاره‌ها (Canvas دوبعدی) */
  /********************************************/
  const starCanvas = document.getElementById("starsCanvas");
  const starCtx = starCanvas.getContext("2d");

  starCanvas.width = window.innerWidth;
  starCanvas.height = window.innerHeight;

  let stars = [];
  let numStars = 180;

  function Star() {
    this.x = Math.random() * starCanvas.width;
    this.y = Math.random() * starCanvas.height;
    this.radius = Math.random() * 2;
    this.dy = Math.random() * 0.7 + 0.3;
    this.opacity = Math.random();
  }

  Star.prototype.draw = function() {
    starCtx.beginPath();
    starCtx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
    starCtx.fillStyle = `rgba(255, 255, 255, ${this.opacity})`;
    starCtx.fill();
  };

  Star.prototype.update = function() {
    this.y += this.dy;
    if (this.y > starCanvas.height) {
      this.y = 0;
      this.x = Math.random() * starCanvas.width;
    }
    this.opacity = Math.abs(Math.sin(Date.now() * 0.0005));
    this.draw();
  };

  function initStars() {
    stars = [];
    for (let i = 0; i < numStars; i++) {
      stars.push(new Star());
    }
  }

  function animateStars() {
    starCtx.clearRect(0, 0, starCanvas.width, starCanvas.height);
    stars.forEach(star => star.update());
    requestAnimationFrame(animateStars);
  }

  initStars();
  animateStars();

  window.addEventListener("resize", () => {
    starCanvas.width = window.innerWidth;
    starCanvas.height = window.innerHeight;
    initStars();
  });


  /********************************************/
  /* ۲) کد کره ماه سه‌بعدی با Three.js */
  /********************************************/
  // صحنه (Scene)
  const scene = new THREE.Scene();

  // دوربین (PerspectiveCamera)
  const camera = new THREE.PerspectiveCamera(
    45,                             // زاویه دید
    window.innerWidth / window.innerHeight, // نسبت تصویر
    0.1,                            // نزدیک‌ترین فاصله دید
    1000                            // دورترین فاصله دید
  );
  camera.position.z = 3; // دوربین کمی از مرکز فاصله داشته باشد

  // ایجاد رندرر
  const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
  renderer.setSize(window.innerWidth, window.innerHeight);

  // قرار دادن خروجی رندر در div با id="three-container"
  const threeContainer = document.getElementById('three-container');
  threeContainer.appendChild(renderer.domElement);

  // نور (مثلا یک PointLight یا AmbientLight)
  const pointLight = new THREE.PointLight(0xffffff, 1);
  pointLight.position.set(5, 5, 5);
  scene.add(pointLight);

  // تکستچر ماه را بارگذاری می‌کنیم (یک تصویر از بافت ماه)
  const moonTexture = new THREE.TextureLoader().load('moon_texture.jpg');

  // ساخت هندسه و متریال
  const geometry = new THREE.SphereGeometry(1, 32, 32); // (شعاع = 1، تقسیمات طول و عرض)
  const material = new THREE.MeshStandardMaterial({ map: moonTexture });

  // ساخت مش (Mesh) کره
  const moonMesh = new THREE.Mesh(geometry, material);
  scene.add(moonMesh);

  // حلقه انیمیشن
  function animateMoon() {
    requestAnimationFrame(animateMoon);

    // چرخش کره
    moonMesh.rotation.y += 0.005; // سرعت چرخش حول محور عمودی
    // moonMesh.rotation.x += 0.001; // اگر کمی حول محور X هم بچرخد

    renderer.render(scene, camera);
  }
  animateMoon();

  // واکنش به تغییر اندازه صفحه
  window.addEventListener('resize', () => {
    renderer.setSize(window.innerWidth, window.innerHeight);
    camera.aspect = window.innerWidth / window.innerHeight;
    camera.updateProjectionMatrix();
  });
  </script>
</body>
</html>
